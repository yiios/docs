# 通讯录 {#test}

对于通讯录模块，APP提供翻阅同部门通讯录和查询全网同事联系方式两种功能。

> 展示同部门通讯录信息受到使用者的职级限制。
>
> 模块入口：进入内部APP，“通讯录”。



---

### 全局功能

#### 返回按钮

部门层级超过三级，导航栏右侧返回按钮，点击按钮返回到通讯录主界面

#### 联系人电话

所有的电话号码都按照以下判断规则：

1. 如果被查看的用户\(`DMShortNumArea`\)，和登录用户在同一区域\(根据登录接口返回的 `Region` 字段进行判断\)  且有短号（`DMShortNum`），则优先显示短号。
2. 如果该用户有公司手机\(`DMTelephone`\)，则显示公司手机；
3. 如果有个人电话\(`DMTeleMobile`\)，则显示个人电话；

![通讯录\_小组成员](/assets/通讯录_小组成员.PNG)

#### 部门头部显示

1. 权限：如果用户没有权限查看部门头部信息，点击显示电话的时候，吐司提示“抱歉,您没有访问权限”。其他和有权限一致。

   权限判断方法：返回该部门的数据中，IsJurisdiction、IsMyLeader、IsSibling 有任意一个为 1，则代表有权限。

   ![通讯录\_无权限](/assets/通讯录_无权限.PNG)

2. 状态请求

   部门、小组、详情界面，进入后调用 **Query\_v2** 接口查询用户的状态，根据 `PeopleIsOnline` 字段进行判断，并刷新界面显示。  
   如果  `PeopleIsOnline` 为 `是`，则显示 `上班`；否则显示 `休息`，显示文字为紫色。

​

1. 如果负责人名字为空，或者非在职状态 \( DMIsWork == 否 \)，则名字、职务、联系号码都处理为空字符串显示。

   ​

2. 电话号码加密：

   如果手机号大于8位，则从第三位起 中间6位显示为`****`。如 `15818663296` 显示为 `158****3296` 。

   如果电话号码小于8位，则显示为 `******`。

   ​

3. 显示、隐藏电话

   点击显示按钮，弹窗提示监控，点击确定后，显示号码在按钮右侧。点击隐藏，号码隐藏。

   第一次显示完该号码后，再次点击不弹窗监控。除非重新进入该界面。

   ![通讯录\_显示电话](/assets/通讯录_显示电话.PNG)

   ​

4. 显示、拨打电话的监控

   点击显示和拨打，都会弹窗提示，点击确定后，会调用 **SaveLogs\_V2** 接口。其中查看的入参为

   ```
   监控日志的入参:{
       col_003 : 徐军, //被查看人的名字
       modeName : 内部APP通讯录,
       uuid : 2AE2BD589613433E95EA8F39303605A1,
       kndType : 查看,
       action : 2
   }
   ```

   拨打的入参为：

   ```
   监控-拨打电话 ： {
       isNotDriver : 1,
       action : 2,
       col_003 : 徐军,//被查看人的名字
       peopleName : 徐军,
       kndType : 拨打,
       modeName : 内部APP通讯录,
       fieldName : 负责人电话
   }
   ```

5. 辅助管理员

   部门返回的 **FZManages** 字段为辅助管理员数组。

   点击部门头部辅助管理员，弹窗显示辅助管理员信息，其中电话号码加密规则同上。点击查看和拨打电话，均会弹窗提示，点击确定后调用监控接口。

   ![通讯录\_辅助管理员](/assets/通讯录_辅助管理员.PNG)

   ![通讯录\_辅助管理员\_监控](/assets/通讯录_辅助管理员_监控.PNG)



